<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>klingons</title>
<link href="Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
<!--Weave of 'klingons' generated by Inweb-->
<div class="breadcrumbs">
    <ul class="crumbs"><li><b>klingons</b></li></ul></div>
<p class="purpose">The purpose of klingons, a fork of klingons, is to give me a useful base program to hack on until I really "get C." It also offers me a chance to learn yet another literate programming system, one that specifically groans about reinventing the wheel, but not so much as Noweb did when it refused to abandon ye olde UNIXÂ® way of pipes and small, dedicated tooling pieced together to make something emergent and new.</p>

<ul class="toc"><li><a href="S-all.html#SP1">&#167;1. </a></li><li><a href="S-all.html#SP2">&#167;2. </a></li><li><a href="S-all.html#SP7">&#167;7. Failure display, using indirection to select a function for communicating with the user</a></li><li><a href="S-all.html#SP8">&#167;8. </a></li><li><a href="S-all.html#SP9">&#167;9. </a></li><li><a href="S-all.html#SP10">&#167;10. </a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP9_1" class="paragraph-anchor"></a><b>&#167;9.1.  </b><span class="named-paragraph-container code-font"><span class="named-paragraph-defn">klingons logogram</span><span class="named-paragraph-number">9.1</span></span><span class="comment-syntax"> =</span>
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="string-syntax">"Â›2JÂ›1;32m\n"</span>
<span class="string-syntax">"ÂˆÂˆW  ÂˆÂˆWÂˆÂˆW     ÂˆÂˆWÂˆÂˆÂˆW   ÂˆÂˆW ÂˆÂˆÂˆÂˆÂˆÂˆW  ÂˆÂˆÂˆÂˆÂˆÂˆW ÂˆÂˆÂˆW   ÂˆÂˆWÂˆÂˆÂˆÂˆÂˆÂˆÂˆW\n"</span>
<span class="string-syntax">"ÂˆÂˆQ ÂˆÂˆT]ÂˆÂˆQ     ÂˆÂˆQÂˆÂˆÂˆÂˆW  ÂˆÂˆQÂˆÂˆTPPPP] ÂˆÂˆTPPPÂˆÂˆWÂˆÂˆÂˆÂˆW  ÂˆÂˆQÂˆÂˆTPPPP]\n"</span>
<span class="string-syntax">"ÂˆÂˆÂˆÂˆÂˆT] ÂˆÂˆQ     ÂˆÂˆQÂˆÂˆTÂˆÂˆW ÂˆÂˆQÂˆÂˆQ  ÂˆÂˆÂˆWÂˆÂˆQ   ÂˆÂˆQÂˆÂˆTÂˆÂˆW ÂˆÂˆQÂˆÂˆÂˆÂˆÂˆÂˆÂˆW\n"</span>
<span class="string-syntax">"ÂˆÂˆTPÂˆÂˆW ÂˆÂˆQ     ÂˆÂˆQÂˆÂˆQZÂˆÂˆWÂˆÂˆQÂˆÂˆQ   ÂˆÂˆQÂˆÂˆQ   ÂˆÂˆQÂˆÂˆQZÂˆÂˆWÂˆÂˆQZPPPPÂˆÂˆQ\n"</span>
<span class="string-syntax">"ÂˆÂˆQ  ÂˆÂˆWÂˆÂˆÂˆÂˆÂˆÂˆÂˆWÂˆÂˆQÂˆÂˆQ ZÂˆÂˆÂˆÂˆQZÂˆÂˆÂˆÂˆÂˆÂˆT]ZÂˆÂˆÂˆÂˆÂˆÂˆT]ÂˆÂˆQ ZÂˆÂˆÂˆÂˆQÂˆÂˆÂˆÂˆÂˆÂˆÂˆQ\n"</span>
<span class="string-syntax">"ZP]  ZP]ZPPPPPP]ZP]ZP]  ZPPP] ZPPPPP]  ZPPPPP] ZP]  ZPPP]ZPPPPPP]\n\n"</span>
</pre>
<ul class="endnotetexts"><li>This code is used in <a href="S-all.html#SP9">&#167;9</a>.</li></ul>
<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1.  </b>Inclusions
</p>

<p class="commentary">These are the headers which are needed by this web. First the non-standard
header files are given, which exist in the <span class="extract"><span class="extract-syntax">include</span></span> directory until they are
integrated into this web directly.
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">#</span><span class="identifier-syntax">include</span><span class="plain-syntax"> </span><span class="string-syntax">"termcolor-c.h"</span>

<span class="plain-syntax">#</span><span class="identifier-syntax">include</span><span class="plain-syntax"> &lt;</span><span class="identifier-syntax">dirent</span><span class="plain-syntax">.</span><span class="identifier-syntax">h</span><span class="plain-syntax">&gt;</span>
<span class="plain-syntax">#</span><span class="identifier-syntax">include</span><span class="plain-syntax"> &lt;</span><span class="identifier-syntax">errno</span><span class="plain-syntax">.</span><span class="identifier-syntax">h</span><span class="plain-syntax">&gt;</span>
<span class="plain-syntax">#</span><span class="identifier-syntax">include</span><span class="plain-syntax"> &lt;</span><span class="identifier-syntax">signal</span><span class="plain-syntax">.</span><span class="identifier-syntax">h</span><span class="plain-syntax">&gt;</span>
<span class="plain-syntax">#</span><span class="identifier-syntax">include</span><span class="plain-syntax"> &lt;</span><span class="identifier-syntax">stdbool</span><span class="plain-syntax">.</span><span class="identifier-syntax">h</span><span class="plain-syntax">&gt;</span>
<span class="plain-syntax">#</span><span class="identifier-syntax">include</span><span class="plain-syntax"> &lt;</span><span class="identifier-syntax">stdio</span><span class="plain-syntax">.</span><span class="identifier-syntax">h</span><span class="plain-syntax">&gt;</span>
<span class="plain-syntax">#</span><span class="identifier-syntax">include</span><span class="plain-syntax"> &lt;</span><span class="identifier-syntax">stdlib</span><span class="plain-syntax">.</span><span class="identifier-syntax">h</span><span class="plain-syntax">&gt;</span>
<span class="plain-syntax">#</span><span class="identifier-syntax">include</span><span class="plain-syntax"> &lt;</span><span class="identifier-syntax">string</span><span class="plain-syntax">.</span><span class="identifier-syntax">h</span><span class="plain-syntax">&gt;</span>
<span class="plain-syntax">#</span><span class="identifier-syntax">include</span><span class="plain-syntax"> &lt;</span><span class="identifier-syntax">sys</span><span class="plain-syntax">/</span><span class="identifier-syntax">stat</span><span class="plain-syntax">.</span><span class="identifier-syntax">h</span><span class="plain-syntax">&gt;</span>
<span class="plain-syntax">#</span><span class="identifier-syntax">include</span><span class="plain-syntax"> &lt;</span><span class="identifier-syntax">sys</span><span class="plain-syntax">/</span><span class="identifier-syntax">types</span><span class="plain-syntax">.</span><span class="identifier-syntax">h</span><span class="plain-syntax">&gt;</span>
<span class="plain-syntax">#</span><span class="identifier-syntax">include</span><span class="plain-syntax"> &lt;</span><span class="identifier-syntax">time</span><span class="plain-syntax">.</span><span class="identifier-syntax">h</span><span class="plain-syntax">&gt;</span>
<span class="plain-syntax">#</span><span class="identifier-syntax">include</span><span class="plain-syntax"> &lt;</span><span class="identifier-syntax">unistd</span><span class="plain-syntax">.</span><span class="identifier-syntax">h</span><span class="plain-syntax">&gt;</span>

<span class="plain-syntax">@&lt;</span><span class="identifier-syntax">includes</span><span class="plain-syntax">@&gt; </span><span class="identifier-syntax">Predeclaration</span><span class="plain-syntax"> </span><span class="identifier-syntax">of</span><span class="plain-syntax"> </span><span class="identifier-syntax">identifiers</span><span class="plain-syntax"> </span><span class="reserved-syntax">for</span><span class="plain-syntax"> </span><span class="identifier-syntax">ANSI</span><span class="plain-syntax"> </span><span class="identifier-syntax">C</span>

<span class="identifier-syntax">ANSI</span><span class="plain-syntax"> </span><span class="identifier-syntax">C</span><span class="plain-syntax"> </span><span class="identifier-syntax">requires</span><span class="plain-syntax"> </span><span class="identifier-syntax">that</span><span class="plain-syntax"> </span><span class="identifier-syntax">identifiers</span><span class="plain-syntax"> </span><span class="identifier-syntax">be</span><span class="plain-syntax"> </span><span class="identifier-syntax">predeclared</span><span class="plain-syntax"> </span><span class="identifier-syntax">before</span><span class="plain-syntax"> </span><span class="identifier-syntax">their</span><span class="plain-syntax"> </span><span class="identifier-syntax">first</span><span class="plain-syntax"> </span><span class="identifier-syntax">usage</span><span class="plain-syntax"> </span><span class="identifier-syntax">in</span><span class="plain-syntax"> </span><span class="identifier-syntax">a</span>
<span class="identifier-syntax">file</span><span class="plain-syntax">. </span><span class="identifier-syntax">This</span><span class="plain-syntax"> </span><span class="identifier-syntax">leads</span><span class="plain-syntax"> </span><span class="identifier-syntax">to</span><span class="plain-syntax"> </span><span class="identifier-syntax">a</span><span class="plain-syntax"> </span><span class="identifier-syntax">large</span><span class="plain-syntax"> </span><span class="identifier-syntax">amount</span><span class="plain-syntax"> </span><span class="identifier-syntax">of</span><span class="plain-syntax"> </span><span class="string-syntax">"header"</span><span class="plain-syntax">. </span><span class="identifier-syntax">I</span><span class="plain-syntax"> </span><span class="identifier-syntax">prefer</span><span class="plain-syntax"> </span><span class="identifier-syntax">headless</span><span class="plain-syntax"> </span><span class="identifier-syntax">files</span><span class="plain-syntax">, </span><span class="identifier-syntax">which</span>
<span class="identifier-syntax">exist</span><span class="plain-syntax"> </span><span class="identifier-syntax">without</span><span class="plain-syntax"> </span><span class="identifier-syntax">headers</span><span class="plain-syntax"> </span><span class="identifier-syntax">and</span><span class="plain-syntax"> </span><span class="identifier-syntax">don</span><span class="character-syntax">'t use a massive interconnected chain of |include|</span>
<span class="character-syntax">preprocessor directives. I like to define something a single time. Inweb</span>
<span class="character-syntax">benefits me in that it provides for avoiding predeclaration, but I won'</span><span class="identifier-syntax">t</span><span class="plain-syntax"> </span><span class="identifier-syntax">use</span>
<span class="identifier-syntax">that</span><span class="plain-syntax"> </span><span class="identifier-syntax">utility</span><span class="plain-syntax"> </span><span class="identifier-syntax">yet</span><span class="plain-syntax">. </span><span class="identifier-syntax">I</span><span class="character-syntax">'ll only use Inweb'</span><span class="identifier-syntax">s</span><span class="plain-syntax"> </span><span class="string-syntax">"paragraphing"</span><span class="plain-syntax"> </span><span class="identifier-syntax">feature</span><span class="plain-syntax"> (</span><span class="identifier-syntax">chunks</span><span class="plain-syntax"> </span><span class="identifier-syntax">or</span>
<span class="identifier-syntax">modules</span><span class="plain-syntax"> </span><span class="reserved-syntax">if</span><span class="plain-syntax"> </span><span class="identifier-syntax">you</span><span class="character-syntax">'re coming from Noweb or CWEB) to predeclare identifiers a single</span>
<span class="character-syntax">time.</span>

<span class="definition-keyword">define</span> <span class="character-syntax">BIN_PATH "./bin"</span>
<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">delay</span></a><span class="plain-syntax">(</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">seconds</span><span class="plain-syntax">);</span>

<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_cmd</span></a><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">command</span><span class="plain-syntax">);</span>
<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_cmd_output</span></a><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">command</span><span class="plain-syntax">);</span>

<span class="comment-syntax">/ compiles C file at path given with output and returns exit code</span>
<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_compile_output</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">File</span><span class="plain-syntax"> </span><span class="identifier-syntax">failed_file</span><span class="plain-syntax">);</span>
<span class="comment-syntax">/ compiles C file at path given with no output and returns exit code</span>
<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_compile</span></a><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">, </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">);</span>

<span class="comment-syntax">/ executes binary at a default location "./bin" expecting no file extension with command output and returns exit code</span>
<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_run_output</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">File</span><span class="plain-syntax"> </span><span class="identifier-syntax">failed_file</span><span class="plain-syntax">);</span>
<span class="comment-syntax">/ executes binary at a default location "./bin" expecting no file extension with no output and returns exit code</span>
<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_run</span></a><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">);</span>

<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_clear_bin</span></a><span class="plain-syntax">();</span>

<span class="reserved-syntax">typedef</span><span class="plain-syntax"> </span><span class="reserved-syntax">enum</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">EXERCISE</span><span class="plain-syntax">,</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">README</span>
<span class="plain-syntax">} </span><span class="identifier-syntax">FileType</span><span class="plain-syntax">;</span>

<span class="reserved-syntax">typedef</span><span class="plain-syntax"> </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_name</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">parent_dir_path</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">bool</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_diff</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">bool</span><span class="plain-syntax"> </span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">FileType</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_type</span><span class="plain-syntax">;</span>
<span class="plain-syntax">} </span><span class="identifier-syntax">File</span><span class="plain-syntax">;</span>

<span class="reserved-syntax">typedef</span><span class="plain-syntax"> </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">File</span><span class="plain-syntax"> *</span><span class="identifier-syntax">files</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">size_t</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">;</span>
<span class="plain-syntax">} </span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax">;</span>

<span class="comment-syntax">/ This assumes that any path does not contain any dividers</span>
<span class="comment-syntax">/ *base_path = "../" or "./" or "/" if needed, otherwise pass ""</span>
<span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">build_file_path</span></a><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> **</span><span class="identifier-syntax">paths</span><span class="plain-syntax">, </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">size</span><span class="plain-syntax">, </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">base_path</span><span class="plain-syntax">);</span>
<span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">read_file_contents</span></a><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">);</span>
<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">add_dir</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax"> **</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">, </span><span class="identifier-syntax">File</span><span class="plain-syntax"> *</span><span class="identifier-syntax">files</span><span class="plain-syntax">, </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">, </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">);</span>
<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">load_files</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax"> **</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">);</span>
<span class="identifier-syntax">bool</span><span class="plain-syntax"> </span><span class="function-syntax">is_marked_incomplete</span><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">, </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_contents_size</span><span class="plain-syntax">);</span>
<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">alphasort</span></a><span class="plain-syntax">(</span><span class="reserved-syntax">const</span><span class="plain-syntax"> </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">dirent</span><span class="plain-syntax"> **</span><span class="identifier-syntax">a</span><span class="plain-syntax">, </span><span class="reserved-syntax">const</span><span class="plain-syntax"> </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">dirent</span><span class="plain-syntax"> **</span><span class="identifier-syntax">b</span><span class="plain-syntax">);</span>

<span class="reserved-syntax">typedef</span><span class="plain-syntax"> </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">char</span><span class="plain-syntax">* </span><span class="identifier-syntax">readme</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax">* </span><span class="identifier-syntax">exercise_files</span><span class="plain-syntax">;</span>
<span class="plain-syntax">} </span><span class="identifier-syntax">Exercise</span><span class="plain-syntax">;</span>

<span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><a href="S-all.html#SP5" class="function-link"><span class="function-syntax">create_exercise</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax"> *</span><span class="identifier-syntax">files</span><span class="plain-syntax">);</span>
<span class="reserved-syntax">char</span><span class="plain-syntax">* </span><span class="identifier-syntax">get_readme</span><span class="plain-syntax">(</span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax"> *</span><span class="identifier-syntax">dir</span><span class="plain-syntax">);</span>
<span class="identifier-syntax">FileCollection</span><span class="plain-syntax">* </span><span class="identifier-syntax">get_exercises</span><span class="plain-syntax">(</span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax"> *</span><span class="identifier-syntax">dir</span><span class="plain-syntax">);</span>

<span class="comment-syntax"> NOTE: used as the index into failure_function[].</span>
<span class="reserved-syntax">typedef</span><span class="plain-syntax"> </span><span class="reserved-syntax">enum</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">RUNTIME</span><span class="plain-syntax">,</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">COMPILATION</span><span class="plain-syntax">,</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">NONE</span><span class="plain-syntax">,</span>
<span class="plain-syntax">} </span><span class="identifier-syntax">FailureMode</span><span class="plain-syntax">;</span>

<span class="reserved-syntax">typedef</span><span class="plain-syntax"> </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">FailureMode</span><span class="plain-syntax"> </span><span class="identifier-syntax">failure_mode</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">bool</span><span class="plain-syntax"> </span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">failing_file</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">total_files</span><span class="plain-syntax">;</span>
<span class="plain-syntax">} </span><span class="identifier-syntax">ExecutionState</span><span class="plain-syntax">;</span>

<span class="reserved-syntax">typedef</span><span class="plain-syntax"> </span><span class="reserved-syntax">enum</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">FAILURE</span><span class="plain-syntax">,</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">MARKED_INCOMPLETE</span><span class="plain-syntax">,</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">COMPLETE</span><span class="plain-syntax">,</span>
<span class="plain-syntax">} </span><span class="identifier-syntax">DisplayMode</span><span class="plain-syntax">;</span>

<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><a href="S-all.html#SP6" class="function-link"><span class="function-syntax">display</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, </span><span class="identifier-syntax">ExecutionState</span><span class="plain-syntax"> *</span><span class="identifier-syntax">state</span><span class="plain-syntax">, </span><span class="identifier-syntax">DisplayMode</span><span class="plain-syntax"> </span><span class="identifier-syntax">display_mode</span><span class="plain-syntax">);</span>
<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><a href="S-all.html#SP10" class="function-link"><span class="function-syntax">display_debug</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">);</span>
<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><a href="S-all.html#SP7" class="function-link"><span class="function-syntax">display_failure</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, </span><span class="identifier-syntax">ExecutionState</span><span class="plain-syntax"> *</span><span class="identifier-syntax">state</span><span class="plain-syntax">);</span>
<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><a href="S-all.html#SP9" class="function-link"><span class="function-syntax">display_success</span></a><span class="plain-syntax">();</span>
<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">display_marked_incomplete</span><button class="popup" onclick="togglePopup('usagePopup1')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup1">Usage of <span class="code-font"><span class="function-syntax">display_marked_incomplete</span></span>:<br/><a href="S-all.html#SP6">&#167;6</a></span></button><span class="plain-syntax">(</span><span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, </span><span class="identifier-syntax">ExecutionState</span><span class="plain-syntax"> *</span><span class="identifier-syntax">state</span><span class="plain-syntax">);</span>
<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">display_progress</span><button class="popup" onclick="togglePopup('usagePopup2')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup2">Usage of <span class="code-font"><span class="function-syntax">display_progress</span></span>:<br/><a href="S-all.html#SP6">&#167;6</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">current_exercise</span><span class="plain-syntax">, </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">total_exercises</span><span class="plain-syntax">);</span>
</pre>
<ul class="endnotetexts"><li>The function delay is used in <a href="S-all.html#SP2">&#167;2</a>, <a href="S-all.html#SP4">&#167;4</a>.</li><li>The function exec_cmd is used in <a href="S-all.html#SP3">&#167;3</a>.</li><li>The function exec_cmd_output is used in <a href="S-all.html#SP3">&#167;3</a>.</li><li>The function exec_compile_output is used in <a href="S-all.html#SP3">&#167;3</a>, <a href="S-all.html#SP7">&#167;7</a>.</li><li>The function exec_compile is used in <a href="S-all.html#SP2">&#167;2</a>, <a href="S-all.html#SP3">&#167;3</a>.</li><li>The function exec_run_output is used in <a href="S-all.html#SP3">&#167;3</a>, <a href="S-all.html#SP7">&#167;7</a>.</li><li>The function exec_run is used in <a href="S-all.html#SP2">&#167;2</a>, <a href="S-all.html#SP3">&#167;3</a>.</li><li>The function exec_clear_bin is used in <a href="S-all.html#SP3">&#167;3</a>.</li><li>The function build_file_path is used in <a href="S-all.html#SP4">&#167;4</a>.</li><li>The function read_file_contents is used in <a href="S-all.html#SP4">&#167;4</a>.</li><li>The function add_dir is used in <a href="S-all.html#SP4">&#167;4</a>.</li><li>The function load_files is used in <a href="S-all.html#SP2">&#167;2</a>, <a href="S-all.html#SP4">&#167;4</a>.</li><li>The function alphasort is used in <a href="S-all.html#SP4">&#167;4</a>.</li><li>The function create_exercise is used in <a href="S-all.html#SP2">&#167;2</a>, <a href="S-all.html#SP5">&#167;5</a>.</li><li>The function display is used in <a href="S-all.html#SP2">&#167;2</a>, <a href="S-all.html#SP6">&#167;6</a>.</li><li>The function display_debug is used in <a href="S-all.html#SP2">&#167;2</a>, <a href="S-all.html#SP10">&#167;10</a>.</li><li>The function display_failure is used in <a href="S-all.html#SP6">&#167;6</a>, <a href="S-all.html#SP7">&#167;7</a>.</li><li>The function display_success is used in <a href="S-all.html#SP6">&#167;6</a>, <a href="S-all.html#SP9">&#167;9</a>.</li></ul>
<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2.  </b>Mainland programming
<span class="extract"><span class="extract-syntax">TOTAL_EXERCISES_DIRS</span></span> was formerly defined as the integer constant three, but I
 didn't see why this needed to be.
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">TOTAL_EXERCISES_DIRS</span><span class="plain-syntax">;</span>
<span class="reserved-syntax">static</span><span class="plain-syntax"> </span><span class="reserved-syntax">volatile</span><span class="plain-syntax"> </span><span class="identifier-syntax">sig_atomic_t</span><span class="plain-syntax"> </span><span class="identifier-syntax">keep_running</span><span class="plain-syntax"> = </span><span class="constant-syntax">1</span><span class="plain-syntax">;</span>

<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">exec_exercise</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, </span><span class="identifier-syntax">ExecutionState</span><span class="plain-syntax"> *</span><span class="identifier-syntax">state</span><span class="plain-syntax">);</span>
<span class="identifier-syntax">FailureMode</span><span class="plain-syntax"> </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">find_failure_mode</span></a><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">, </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">);</span>
<span class="identifier-syntax">bool</span><span class="plain-syntax"> </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">is_file_diff</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">);</span>

<span class="reserved-syntax">static</span><span class="plain-syntax"> </span><span class="reserved-syntax">void</span><span class="plain-syntax"> </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">sig_handler</span></a><span class="plain-syntax">(</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">_</span><span class="plain-syntax">);</span>
<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">print_usage</span></a><span class="plain-syntax">();</span>
<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">count_dir</span></a><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">dir</span><span class="plain-syntax">);</span>

<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">main</span><span class="plain-syntax">(</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">argc</span><span class="plain-syntax">, </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">argv</span><span class="plain-syntax">[]) {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">signal</span><span class="plain-syntax">(</span><span class="identifier-syntax">SIGINT</span><span class="plain-syntax">, </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">sig_handler</span></a><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">TOTAL_EXERCISES_DIRS</span><span class="plain-syntax"> = </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">count_dir</span></a><span class="plain-syntax">(</span><span class="string-syntax">"./exercises"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">TOTAL_EXERCISES_DIRS</span><span class="plain-syntax"> == -1) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="constant-syntax">1</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">start_at</span><span class="plain-syntax"> = </span><span class="constant-syntax">1</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">c</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">opterr</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">while</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">c</span><span class="plain-syntax"> = </span><span class="identifier-syntax">getopt</span><span class="plain-syntax">(</span><span class="identifier-syntax">argc</span><span class="plain-syntax">, </span><span class="identifier-syntax">argv</span><span class="plain-syntax">, </span><span class="string-syntax">"s:"</span><span class="plain-syntax">)) != -1) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">switch</span><span class="plain-syntax"> (</span><span class="identifier-syntax">c</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="character-syntax">'s'</span><span class="plain-syntax">:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">start_at</span><span class="plain-syntax"> = </span><span class="identifier-syntax">atoi</span><span class="plain-syntax">(</span><span class="identifier-syntax">optarg</span><span class="plain-syntax">);</span>

<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">start_at</span><span class="plain-syntax"> &gt; </span><span class="identifier-syntax">TOTAL_EXERCISES_DIRS</span><span class="plain-syntax"> || </span><span class="identifier-syntax">start_at</span><span class="plain-syntax"> &lt; </span><span class="constant-syntax">1</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">printf</span><span class="plain-syntax">(</span><span class="string-syntax">"error: cannot start at %d (max. exercises: %d)\n"</span><span class="plain-syntax">,</span>
<span class="plain-syntax">                       </span><span class="identifier-syntax">start_at</span><span class="plain-syntax">, </span><span class="identifier-syntax">TOTAL_EXERCISES_DIRS</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">EXIT_FAILURE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            }</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">printf</span><span class="plain-syntax">(</span><span class="string-syntax">"Starting at exercise %d ...\n"</span><span class="plain-syntax">, </span><span class="identifier-syntax">start_at</span><span class="plain-syntax">);</span>

<span class="plain-syntax">            </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">delay</span></a><span class="plain-syntax">(2);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">default</span><span class="plain-syntax">:</span>
<span class="plain-syntax">            </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">print_usage</span></a><span class="plain-syntax">();</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">EXIT_SUCCESS</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">rerun_all</span><span class="plain-syntax"> = </span><span class="identifier-syntax">true</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">ExecutionState</span><span class="plain-syntax"> </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">.</span><span class="identifier-syntax">failure_mode</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NONE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">.</span><span class="identifier-syntax">failing_file</span><span class="plain-syntax"> = -1;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">.</span><span class="identifier-syntax">total_files</span><span class="plain-syntax"> = -1;</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax"> **</span><span class="identifier-syntax">dirs</span><span class="plain-syntax"> =</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="identifier-syntax">TOTAL_EXERCISES_DIRS</span><span class="plain-syntax"> * </span><span class="reserved-syntax">sizeof</span><span class="plain-syntax">(</span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax"> *));</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dirs</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"Failed allocate memory for dirs"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">TOTAL_EXERCISES_DIRS</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">] = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">while</span><span class="plain-syntax"> (</span><span class="identifier-syntax">keep_running</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">delay</span></a><span class="plain-syntax">(1);</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">exercise_file_ct</span><span class="plain-syntax"> = </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">load_files</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">.</span><span class="identifier-syntax">total_files</span><span class="plain-syntax"> = </span><span class="identifier-syntax">exercise_file_ct</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">d</span><span class="plain-syntax"> = (</span><span class="identifier-syntax">start_at</span><span class="plain-syntax"> - </span><span class="constant-syntax">1</span><span class="plain-syntax">); </span><span class="identifier-syntax">d</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">TOTAL_EXERCISES_DIRS</span><span class="plain-syntax">; </span><span class="identifier-syntax">d</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise</span><span class="plain-syntax"> = </span><a href="S-all.html#SP5" class="function-link"><span class="function-syntax">create_exercise</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">d</span><span class="plain-syntax">]);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">bool</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_diff</span><span class="plain-syntax"> = </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">is_file_diff</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">);</span>

<span class="plain-syntax">#</span><span class="identifier-syntax">ifdef</span><span class="plain-syntax"> </span><span class="identifier-syntax">DEBUG</span>
<span class="plain-syntax">            </span><a href="S-all.html#SP10" class="function-link"><span class="function-syntax">display_debug</span></a><span class="plain-syntax">(&amp;</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">continue</span><span class="plain-syntax">;</span>
<span class="plain-syntax">#</span><span class="identifier-syntax">endif</span>

<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">rerun_all</span><span class="plain-syntax"> == </span><span class="identifier-syntax">true</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">exec_exercise</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, &amp;</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">);</span>

<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">.</span><span class="identifier-syntax">failure_mode</span><span class="plain-syntax"> != </span><span class="identifier-syntax">NONE</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><a href="S-all.html#SP6" class="function-link"><span class="function-syntax">display</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, &amp;</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">, </span><span class="identifier-syntax">FAILURE</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">rerun_all</span><span class="plain-syntax"> = </span><span class="identifier-syntax">false</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                    </span><span class="reserved-syntax">goto</span><span class="plain-syntax"> </span><span class="identifier-syntax">clean_exercise</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                }</span>

<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">.</span><span class="identifier-syntax">failure_mode</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NONE</span><span class="plain-syntax"> &amp;&amp;</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">.</span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax"> == </span><span class="identifier-syntax">true</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><a href="S-all.html#SP6" class="function-link"><span class="function-syntax">display</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, &amp;</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">, </span><span class="identifier-syntax">MARKED_INCOMPLETE</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">rerun_all</span><span class="plain-syntax"> = </span><span class="identifier-syntax">false</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                    </span><span class="reserved-syntax">goto</span><span class="plain-syntax"> </span><span class="identifier-syntax">clean_exercise</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                }</span>

<span class="plain-syntax">                </span><span class="comment-syntax"> end of exercises, no failures</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">d</span><span class="plain-syntax"> == </span><span class="identifier-syntax">TOTAL_EXERCISES_DIRS</span><span class="plain-syntax"> - </span><span class="constant-syntax">1</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><a href="S-all.html#SP6" class="function-link"><span class="function-syntax">display</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, &amp;</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">, </span><span class="identifier-syntax">COMPLETE</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">rerun_all</span><span class="plain-syntax"> = </span><span class="identifier-syntax">false</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                }</span>
<span class="plain-syntax">            }</span>

<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">file_diff</span><span class="plain-syntax"> == </span><span class="identifier-syntax">true</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">exec_exercise</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, &amp;</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">);</span>

<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">.</span><span class="identifier-syntax">failure_mode</span><span class="plain-syntax"> != </span><span class="identifier-syntax">NONE</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><a href="S-all.html#SP6" class="function-link"><span class="function-syntax">display</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, &amp;</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">, </span><span class="identifier-syntax">FAILURE</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">rerun_all</span><span class="plain-syntax"> = </span><span class="identifier-syntax">false</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                    </span><span class="reserved-syntax">goto</span><span class="plain-syntax"> </span><span class="identifier-syntax">clean_exercise</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                }</span>

<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">.</span><span class="identifier-syntax">failure_mode</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NONE</span><span class="plain-syntax"> &amp;&amp;</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">.</span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax"> == </span><span class="identifier-syntax">true</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><a href="S-all.html#SP6" class="function-link"><span class="function-syntax">display</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, &amp;</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">, </span><span class="identifier-syntax">MARKED_INCOMPLETE</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">rerun_all</span><span class="plain-syntax"> = </span><span class="identifier-syntax">false</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                    </span><span class="reserved-syntax">goto</span><span class="plain-syntax"> </span><span class="identifier-syntax">clean_exercise</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                }</span>

<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">.</span><span class="identifier-syntax">failure_mode</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NONE</span><span class="plain-syntax"> &amp;&amp;</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">.</span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax"> == </span><span class="identifier-syntax">false</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">rerun_all</span><span class="plain-syntax"> = </span><span class="identifier-syntax">true</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                }</span>
<span class="plain-syntax">            }</span>

<span class="plain-syntax">        </span><span class="identifier-syntax">clean_exercise</span><span class="plain-syntax">:</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">exercise_files</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">exercise_files</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">di</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">di</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">TOTAL_EXERCISES_DIRS</span><span class="plain-syntax">; </span><span class="identifier-syntax">di</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">di</span><span class="plain-syntax">]) {</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="identifier-syntax">size_t</span><span class="plain-syntax"> </span><span class="identifier-syntax">e</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">e</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">di</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">; </span><span class="identifier-syntax">e</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">di</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">e</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">di</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">e</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">di</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">e</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">di</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">e</span><span class="plain-syntax">].</span><span class="identifier-syntax">parent_dir_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">di</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">e</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            }</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">di</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">di</span><span class="plain-syntax">]);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="constant-syntax">0</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">exec_exercise</span><span class="plain-syntax">(</span><span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, </span><span class="identifier-syntax">ExecutionState</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_ct</span><span class="plain-syntax"> = </span><span class="identifier-syntax">exercise</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">exercise_files</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">File</span><span class="plain-syntax"> *</span><span class="identifier-syntax">files</span><span class="plain-syntax"> = </span><span class="identifier-syntax">exercise</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">exercise_files</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">e</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">e</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">; </span><span class="identifier-syntax">e</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">File</span><span class="plain-syntax"> </span><span class="identifier-syntax">file</span><span class="plain-syntax"> = </span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">e</span><span class="plain-syntax">];</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax"> = </span><span class="identifier-syntax">file</span><span class="plain-syntax">.</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_path</span><span class="plain-syntax"> = </span><span class="identifier-syntax">file</span><span class="plain-syntax">.</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="identifier-syntax">FailureMode</span><span class="plain-syntax"> </span><span class="identifier-syntax">failure_mode</span><span class="plain-syntax"> =</span>
<span class="plain-syntax">            </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">find_failure_mode</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">, </span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">failure_mode</span><span class="plain-syntax"> = </span><span class="identifier-syntax">failure_mode</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax"> = </span><span class="identifier-syntax">file</span><span class="plain-syntax">.</span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">failing_file</span><span class="plain-syntax"> = </span><span class="identifier-syntax">e</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">failure_mode</span><span class="plain-syntax"> != </span><span class="identifier-syntax">NONE</span><span class="plain-syntax"> || </span><span class="identifier-syntax">file</span><span class="plain-syntax">.</span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax"> == </span><span class="identifier-syntax">true</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">return</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">failure_mode</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NONE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax"> = </span><span class="identifier-syntax">false</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">failing_file</span><span class="plain-syntax"> = -1;</span>
<span class="plain-syntax">}</span>

<span class="identifier-syntax">FailureMode</span><span class="plain-syntax"> </span><span class="function-syntax">find_failure_mode</span><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">, </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_compile</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">, </span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">) != </span><span class="constant-syntax">0</span><span class="plain-syntax">) </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">COMPILATION</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_run</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">) != </span><span class="constant-syntax">0</span><span class="plain-syntax">) </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">RUNTIME</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">NONE</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="identifier-syntax">bool</span><span class="plain-syntax"> </span><span class="function-syntax">is_file_diff</span><span class="plain-syntax">(</span><span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_ct</span><span class="plain-syntax"> = </span><span class="identifier-syntax">exercise</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">exercise_files</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">File</span><span class="plain-syntax"> *</span><span class="identifier-syntax">files</span><span class="plain-syntax"> = </span><span class="identifier-syntax">exercise</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">exercise_files</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">bool</span><span class="plain-syntax"> </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">is_file_diff</span></a><span class="plain-syntax"> = </span><span class="identifier-syntax">false</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">e</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">e</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">; </span><span class="identifier-syntax">e</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">File</span><span class="plain-syntax"> </span><span class="identifier-syntax">file</span><span class="plain-syntax"> = </span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">e</span><span class="plain-syntax">];</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">bool</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_diff</span><span class="plain-syntax"> = </span><span class="identifier-syntax">file</span><span class="plain-syntax">.</span><span class="identifier-syntax">file_diff</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">file_diff</span><span class="plain-syntax"> == </span><span class="identifier-syntax">true</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">is_file_diff</span></a><span class="plain-syntax"> = </span><span class="identifier-syntax">true</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><a href="S-all.html#SP2" class="function-link"><span class="function-syntax">is_file_diff</span></a><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">static</span><span class="plain-syntax"> </span><span class="reserved-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">sig_handler</span><span class="plain-syntax">(</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">_</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    (</span><span class="reserved-syntax">void</span><span class="plain-syntax">)</span><span class="identifier-syntax">_</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">keep_running</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">count_dir</span><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">dir</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">dirent</span><span class="plain-syntax"> *</span><span class="identifier-syntax">dp</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">DIR</span><span class="plain-syntax"> *</span><span class="identifier-syntax">fd</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">dir_count</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">fd</span><span class="plain-syntax"> = </span><span class="identifier-syntax">opendir</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir</span><span class="plain-syntax">)) == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">fprintf</span><span class="plain-syntax">(</span><span class="identifier-syntax">stderr</span><span class="plain-syntax">, </span><span class="string-syntax">"count_dir: can't open %s\n"</span><span class="plain-syntax">, </span><span class="identifier-syntax">dir</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">return</span><span class="plain-syntax"> -1;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">while</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">dp</span><span class="plain-syntax"> = </span><span class="identifier-syntax">readdir</span><span class="plain-syntax">(</span><span class="identifier-syntax">fd</span><span class="plain-syntax">)) != </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (!</span><span class="identifier-syntax">strcmp</span><span class="plain-syntax">(</span><span class="identifier-syntax">dp</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">d_name</span><span class="plain-syntax">, </span><span class="string-syntax">"."</span><span class="plain-syntax">) || !</span><span class="identifier-syntax">strcmp</span><span class="plain-syntax">(</span><span class="identifier-syntax">dp</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">d_name</span><span class="plain-syntax">, </span><span class="string-syntax">".."</span><span class="plain-syntax">))</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">continue</span><span class="plain-syntax">; </span><span class="comment-syntax"> skip self and parent</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">dir_count</span><span class="plain-syntax">++;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">closedir</span><span class="plain-syntax">(</span><span class="identifier-syntax">fd</span><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">dir_count</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">print_usage</span><span class="plain-syntax">() {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">printf</span><span class="plain-syntax">(</span><span class="string-syntax">"Usage:\n\n"</span>
<span class="plain-syntax">           </span><span class="string-syntax">"-s N\tStart at exercise N (between 1 and %d)"</span>
<span class="plain-syntax">           </span><span class="string-syntax">"\n"</span><span class="plain-syntax">,</span>
<span class="plain-syntax">           </span><span class="identifier-syntax">TOTAL_EXERCISES_DIRS</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>
</pre>
<ul class="endnotetexts"><li>The function exec_exercise appears nowhere else.</li><li>The function find_failure_mode appears nowhere else.</li><li>The function is_file_diff appears nowhere else.</li><li>The function sig_handler appears nowhere else.</li><li>The function print_usage appears nowhere else.</li><li>The function count_dir appears nowhere else.</li></ul>
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3.  </b><span class="named-paragraph-container code-font"><span class="named-paragraph-defn">runna</span><span class="named-paragraph-number">3</span></span><span class="comment-syntax"> =</span>
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="reserved-syntax">const</span><span class="plain-syntax"> </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">MAX_LINES</span><span class="plain-syntax"> = </span><span class="constant-syntax">500</span><span class="plain-syntax">;</span>
<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">exec_cmd</span><button class="popup" onclick="togglePopup('usagePopup3')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup3">Usage of <span class="code-font"><span class="function-syntax">exec_cmd</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">command</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">  </span><span class="identifier-syntax">FILE</span><span class="plain-syntax"> *</span><span class="identifier-syntax">fp</span><span class="plain-syntax">;</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">status</span><span class="plain-syntax">;</span>

<span class="plain-syntax">  </span><span class="identifier-syntax">fp</span><span class="plain-syntax"> = </span><span class="identifier-syntax">popen</span><span class="plain-syntax">(</span><span class="identifier-syntax">command</span><span class="plain-syntax">, </span><span class="string-syntax">"w"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">fp</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"Failed to execution popen command"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">  }</span>

<span class="plain-syntax">  </span><span class="identifier-syntax">status</span><span class="plain-syntax"> = </span><span class="identifier-syntax">pclose</span><span class="plain-syntax">(</span><span class="identifier-syntax">fp</span><span class="plain-syntax">);</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">status</span><span class="plain-syntax"> == -1) {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"Failed to close"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">  }</span>

<span class="plain-syntax">  </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">WIFEXITED</span><span class="plain-syntax">(</span><span class="identifier-syntax">status</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">WEXITSTATUS</span><span class="plain-syntax">(</span><span class="identifier-syntax">status</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">  </span><span class="reserved-syntax">return</span><span class="plain-syntax"> -1;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">exec_cmd_output</span><button class="popup" onclick="togglePopup('usagePopup4')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup4">Usage of <span class="code-font"><span class="function-syntax">exec_cmd_output</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">command</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">  </span><span class="identifier-syntax">FILE</span><span class="plain-syntax"> *</span><span class="identifier-syntax">fp</span><span class="plain-syntax">;</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">status</span><span class="plain-syntax">;</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">char</span><span class="plain-syntax"> </span><span class="identifier-syntax">path</span><span class="plain-syntax">[</span><span class="identifier-syntax">MAX_LINES</span><span class="plain-syntax">];</span>

<span class="plain-syntax">  </span><span class="identifier-syntax">fp</span><span class="plain-syntax"> = </span><span class="identifier-syntax">popen</span><span class="plain-syntax">(</span><span class="identifier-syntax">command</span><span class="plain-syntax">, </span><span class="string-syntax">"w"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">fp</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"Failed to execution popen command"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">  }</span>

<span class="plain-syntax">  </span><span class="reserved-syntax">while</span><span class="plain-syntax"> (</span><span class="identifier-syntax">fgets</span><span class="plain-syntax">(</span><span class="identifier-syntax">path</span><span class="plain-syntax">, </span><span class="identifier-syntax">MAX_LINES</span><span class="plain-syntax">, </span><span class="identifier-syntax">fp</span><span class="plain-syntax">) != </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">printf</span><span class="plain-syntax">(</span><span class="string-syntax">"%s"</span><span class="plain-syntax">, </span><span class="identifier-syntax">path</span><span class="plain-syntax">);</span>

<span class="plain-syntax">  </span><span class="identifier-syntax">status</span><span class="plain-syntax"> = </span><span class="identifier-syntax">pclose</span><span class="plain-syntax">(</span><span class="identifier-syntax">fp</span><span class="plain-syntax">);</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">status</span><span class="plain-syntax"> == -1) {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"Failed to close"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">  }</span>

<span class="plain-syntax">  </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">WIFEXITED</span><span class="plain-syntax">(</span><span class="identifier-syntax">status</span><span class="plain-syntax">)) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">WEXITSTATUS</span><span class="plain-syntax">(</span><span class="identifier-syntax">status</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">  </span><span class="reserved-syntax">return</span><span class="plain-syntax"> -1;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">exec_compile_output</span><button class="popup" onclick="togglePopup('usagePopup5')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup5">Usage of <span class="code-font"><span class="function-syntax">exec_compile_output</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a>, <a href="S-all.html#SP7">&#167;7</a></span></button><span class="plain-syntax">(</span><span class="identifier-syntax">File</span><span class="plain-syntax"> </span><span class="identifier-syntax">failed_file</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">path_len</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strlen</span><span class="plain-syntax">(</span><span class="identifier-syntax">failed_file</span><span class="plain-syntax">.</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_name_len</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strlen</span><span class="plain-syntax">(</span><span class="identifier-syntax">failed_file</span><span class="plain-syntax">.</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">buff_size</span><span class="plain-syntax"> = </span><span class="identifier-syntax">path_len</span><span class="plain-syntax"> + </span><span class="identifier-syntax">file_name_len</span><span class="plain-syntax"> + </span><span class="constant-syntax">48</span><span class="plain-syntax">; </span><span class="comment-syntax"> 35 is for gcc flags and other stuff</span>

<span class="plain-syntax">    </span><span class="comment-syntax"> check for BIN_PATH</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">DIR</span><span class="plain-syntax">* </span><span class="identifier-syntax">dir</span><span class="plain-syntax"> = </span><span class="identifier-syntax">opendir</span><span class="plain-syntax">(</span><span class="constant-syntax">BIN_PATH</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dir</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="comment-syntax"> BIN_PATH already exists</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">closedir</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">ENOENT</span><span class="plain-syntax"> == </span><span class="identifier-syntax">errno</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="comment-syntax"> need to make BIN_PATH</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">mkdir</span><span class="plain-syntax">(</span><span class="constant-syntax">BIN_PATH</span><span class="plain-syntax">, </span><span class="constant-syntax">0700</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"probing BIN_PATH failed"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="comment-syntax"> create snprintf buffer</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">compile_cmd</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="identifier-syntax">buff_size</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">snprintf</span><span class="plain-syntax">(</span><span class="identifier-syntax">compile_cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">buff_size</span><span class="plain-syntax">, </span><span class="string-syntax">"gcc %s -o %s/%s -lm"</span><span class="plain-syntax">, </span><span class="identifier-syntax">failed_file</span><span class="plain-syntax">.</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">, </span><span class="constant-syntax">BIN_PATH</span><span class="plain-syntax">, </span><span class="identifier-syntax">failed_file</span><span class="plain-syntax">.</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">res_code</span><span class="plain-syntax"> = </span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_cmd_output</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">compile_cmd</span><span class="plain-syntax">);</span>

<span class="plain-syntax">  </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">compile_cmd</span><span class="plain-syntax">);</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">res_code</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">exec_run_output</span><button class="popup" onclick="togglePopup('usagePopup6')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup6">Usage of <span class="code-font"><span class="function-syntax">exec_run_output</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a>, <a href="S-all.html#SP7">&#167;7</a></span></button><span class="plain-syntax">(</span><span class="identifier-syntax">File</span><span class="plain-syntax"> </span><span class="identifier-syntax">failed_file</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_path_size</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strlen</span><span class="plain-syntax">(</span><span class="identifier-syntax">failed_file</span><span class="plain-syntax">.</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">) + </span><span class="constant-syntax">7</span><span class="plain-syntax">;</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_path</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_path_size</span><span class="plain-syntax">); </span><span class="comment-syntax"> add 5 for binary path</span>
<span class="plain-syntax">  </span><span class="identifier-syntax">snprintf</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">, </span><span class="identifier-syntax">file_path_size</span><span class="plain-syntax">, </span><span class="string-syntax">"%s/%s"</span><span class="plain-syntax">, </span><span class="constant-syntax">BIN_PATH</span><span class="plain-syntax">, </span><span class="identifier-syntax">failed_file</span><span class="plain-syntax">.</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">res_code</span><span class="plain-syntax"> = </span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_cmd_output</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">);</span>

<span class="plain-syntax">  </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">res_code</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">exec_compile</span><button class="popup" onclick="togglePopup('usagePopup7')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup7">Usage of <span class="code-font"><span class="function-syntax">exec_compile</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a>, <a href="S-all.html#SP2">&#167;2</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">, </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">path_len</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strlen</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_name_len</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strlen</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">buff_size</span><span class="plain-syntax"> = </span><span class="identifier-syntax">path_len</span><span class="plain-syntax"> + </span><span class="identifier-syntax">file_name_len</span><span class="plain-syntax"> + </span><span class="constant-syntax">48</span><span class="plain-syntax">; </span><span class="comment-syntax"> 35 is for gcc flags and other stuff</span>

<span class="plain-syntax">    </span><span class="comment-syntax"> check for BIN_PATH</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">DIR</span><span class="plain-syntax">* </span><span class="identifier-syntax">dir</span><span class="plain-syntax"> = </span><span class="identifier-syntax">opendir</span><span class="plain-syntax">(</span><span class="constant-syntax">BIN_PATH</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dir</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="comment-syntax"> BIN_PATH already exists</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">closedir</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">ENOENT</span><span class="plain-syntax"> == </span><span class="identifier-syntax">errno</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="comment-syntax"> need to make BIN_PATH</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">mkdir</span><span class="plain-syntax">(</span><span class="constant-syntax">BIN_PATH</span><span class="plain-syntax">, </span><span class="constant-syntax">0700</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"probing BIN_PATH failed"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="comment-syntax"> create snprintf buffer</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">compile_cmd</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="identifier-syntax">buff_size</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="comment-syntax"> snprintf(compile_cmd, buff_size, "gcc %s -o %s/%s -Wall -Wextra -Werror", file_path, BIN_PATH ,file_name_no_ext);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">snprintf</span><span class="plain-syntax">(</span><span class="identifier-syntax">compile_cmd</span><span class="plain-syntax">, </span><span class="identifier-syntax">buff_size</span><span class="plain-syntax">, </span><span class="string-syntax">"gcc %s -o %s/%s -lm"</span><span class="plain-syntax">, </span><span class="identifier-syntax">file_path</span><span class="plain-syntax">, </span><span class="constant-syntax">BIN_PATH</span><span class="plain-syntax">, </span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">printf</span><span class="plain-syntax">(</span><span class="string-syntax">"compile statement: %s \n"</span><span class="plain-syntax">, </span><span class="identifier-syntax">compile_cmd</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">res_code</span><span class="plain-syntax"> = </span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_cmd</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">compile_cmd</span><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">compile_cmd</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">res_code</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">exec_run</span><button class="popup" onclick="togglePopup('usagePopup8')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup8">Usage of <span class="code-font"><span class="function-syntax">exec_run</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a>, <a href="S-all.html#SP2">&#167;2</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_path_size</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strlen</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">) + </span><span class="constant-syntax">7</span><span class="plain-syntax">;</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_path</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_path_size</span><span class="plain-syntax">); </span><span class="comment-syntax"> add 5 for binary path</span>
<span class="plain-syntax">  </span><span class="identifier-syntax">snprintf</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">, </span><span class="identifier-syntax">file_path_size</span><span class="plain-syntax">, </span><span class="string-syntax">"%s/%s"</span><span class="plain-syntax">, </span><span class="constant-syntax">BIN_PATH</span><span class="plain-syntax">, </span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">res_code</span><span class="plain-syntax"> = </span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_cmd</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">);</span>

<span class="plain-syntax">  </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">res_code</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">exec_clear_bin</span><button class="popup" onclick="togglePopup('usagePopup9')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup9">Usage of <span class="code-font"><span class="function-syntax">exec_clear_bin</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a></span></button><span class="plain-syntax">() {</span>
<span class="plain-syntax">  </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">command</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(14); </span><span class="comment-syntax"> add 5 for binary path</span>
<span class="plain-syntax">  </span><span class="identifier-syntax">snprintf</span><span class="plain-syntax">(</span><span class="identifier-syntax">command</span><span class="plain-syntax">, </span><span class="constant-syntax">14</span><span class="plain-syntax">, </span><span class="string-syntax">"rm -r %s</span><span class="comment-syntax">", BIN_PATH);</span>
<span class="string-syntax">    int res_code = exec_cmd(command);</span>

<span class="string-syntax">  free(command);</span>
<span class="string-syntax">  return res_code;</span>
<span class="string-syntax">}</span>
</pre>
<ul class="endnotetexts"><li>This code is never used.</li></ul>
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4.  </b><span class="named-paragraph-container code-font"><span class="named-paragraph-defn">utils</span><span class="named-paragraph-number">4</span></span><span class="comment-syntax"> =</span>
</p>

<pre class="displayed-code all-displayed-code code-font">

<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">delay</span><button class="popup" onclick="togglePopup('usagePopup10')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup10">Usage of <span class="code-font"><span class="function-syntax">delay</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a>, <a href="S-all.html#SP2">&#167;2</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">seconds</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">m_secs</span><span class="plain-syntax"> = </span><span class="constant-syntax">1000000</span><span class="plain-syntax"> * </span><span class="identifier-syntax">seconds</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">clock_t</span><span class="plain-syntax"> </span><span class="identifier-syntax">start_time</span><span class="plain-syntax"> = </span><span class="identifier-syntax">clock</span><span class="plain-syntax">();</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">while</span><span class="plain-syntax"> (</span><span class="identifier-syntax">clock</span><span class="plain-syntax">() &lt; </span><span class="identifier-syntax">start_time</span><span class="plain-syntax"> + </span><span class="identifier-syntax">m_secs</span><span class="plain-syntax">) {};</span>
<span class="plain-syntax">}</span>

<span class="plain-syntax">@&lt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">@&gt;</span><span class="identifier-syntax">Files</span><span class="plain-syntax"> </span><span class="identifier-syntax">and</span><span class="plain-syntax"> </span><span class="identifier-syntax">their</span><span class="plain-syntax"> </span><span class="identifier-syntax">conception</span><span class="plain-syntax"> </span><span class="identifier-syntax">within</span><span class="plain-syntax"> </span><span class="identifier-syntax">klingons</span>
<span class="identifier-syntax">This</span><span class="plain-syntax"> </span><span class="identifier-syntax">portion</span><span class="plain-syntax"> </span><span class="identifier-syntax">of</span><span class="plain-syntax"> </span><span class="identifier-syntax">the</span><span class="plain-syntax"> </span><span class="identifier-syntax">web</span><span class="plain-syntax"> </span><span class="identifier-syntax">defines</span><span class="plain-syntax"> </span><span class="identifier-syntax">a</span><span class="plain-syntax"> </span><span class="identifier-syntax">type</span><span class="plain-syntax"> |</span><span class="identifier-syntax">File</span><span class="plain-syntax">| </span><span class="identifier-syntax">and</span><span class="plain-syntax"> |</span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax">| </span><span class="identifier-syntax">which</span><span class="plain-syntax"> </span><span class="identifier-syntax">is</span>
<span class="identifier-syntax">tailored</span><span class="plain-syntax"> </span><span class="identifier-syntax">to</span><span class="plain-syntax"> </span><span class="identifier-syntax">the</span><span class="plain-syntax"> </span><span class="identifier-syntax">specific</span><span class="plain-syntax"> </span><span class="identifier-syntax">needs</span><span class="plain-syntax"> </span><span class="identifier-syntax">of</span><span class="plain-syntax"> </span><span class="identifier-syntax">klingons</span><span class="plain-syntax">.</span>
<span class="reserved-syntax">const</span><span class="plain-syntax"> </span><span class="reserved-syntax">char</span><span class="plain-syntax"> </span><span class="identifier-syntax">DIR_PATH</span><span class="plain-syntax">[] = </span><span class="string-syntax">"./exercises"</span><span class="plain-syntax">;</span>
<span class="reserved-syntax">const</span><span class="plain-syntax"> </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">DIR_TYPE_CODE</span><span class="plain-syntax"> = </span><span class="constant-syntax">4</span><span class="plain-syntax">;</span>
<span class="reserved-syntax">const</span><span class="plain-syntax"> </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">FILE_TYPE_CODE</span><span class="plain-syntax"> = </span><span class="constant-syntax">8</span><span class="plain-syntax">;</span>
<span class="reserved-syntax">const</span><span class="plain-syntax"> </span><span class="reserved-syntax">char</span><span class="plain-syntax"> </span><span class="identifier-syntax">README_FILE_NM</span><span class="plain-syntax">[] = </span><span class="string-syntax">"README.md"</span><span class="plain-syntax">;</span>

<span class="comment-syntax">/ This assumes that any path does not contain any dividers</span>
<span class="comment-syntax">/ *base_path = "../" or "./" or "/" if needed, otherwise pass ""</span>
<span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="function-syntax">build_file_path</span><button class="popup" onclick="togglePopup('usagePopup11')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup11">Usage of <span class="code-font"><span class="function-syntax">build_file_path</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> **</span><span class="identifier-syntax">paths</span><span class="plain-syntax">, </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">size</span><span class="plain-syntax">, </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">base_path</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="comment-syntax"> calculate the total length needed for the concatenated path</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">str_len</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strlen</span><span class="plain-syntax">(</span><span class="identifier-syntax">base_path</span><span class="plain-syntax">) + </span><span class="constant-syntax">1</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">size</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">str_len</span><span class="plain-syntax"> += </span><span class="identifier-syntax">strlen</span><span class="plain-syntax">(</span><span class="identifier-syntax">paths</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">]) + </span><span class="constant-syntax">1</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">str_buff</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="identifier-syntax">str_len</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">str_buff</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">printf</span><span class="plain-syntax">(</span><span class="string-syntax">"concat_path_dyn malloc failed"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="comment-syntax"> initialize the buffer with base_path</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">strcpy</span><span class="plain-syntax">(</span><span class="identifier-syntax">str_buff</span><span class="plain-syntax">, </span><span class="identifier-syntax">base_path</span><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">size</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">strcat</span><span class="plain-syntax">(</span><span class="identifier-syntax">str_buff</span><span class="plain-syntax">, </span><span class="identifier-syntax">paths</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">]);</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">i</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">size</span><span class="plain-syntax"> - </span><span class="constant-syntax">1</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">strcat</span><span class="plain-syntax">(</span><span class="identifier-syntax">str_buff</span><span class="plain-syntax">, </span><span class="string-syntax">"/"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">str_buff</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="function-syntax">read_file_contents</span><button class="popup" onclick="togglePopup('usagePopup12')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup12">Usage of <span class="code-font"><span class="function-syntax">read_file_contents</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">stat</span><span class="plain-syntax"> </span><span class="identifier-syntax">fstat_buff</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">FILE</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file</span><span class="plain-syntax"> = </span><span class="identifier-syntax">fopen</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">, </span><span class="string-syntax">"r"</span><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">file</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"Failed to open file"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">fstat</span><span class="plain-syntax">(</span><span class="identifier-syntax">fileno</span><span class="plain-syntax">(</span><span class="identifier-syntax">file</span><span class="plain-syntax">), &amp;</span><span class="identifier-syntax">fstat_buff</span><span class="plain-syntax">) == -1) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"Failed to get file stats"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">fclose</span><span class="plain-syntax">(</span><span class="identifier-syntax">file</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">long</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_size</span><span class="plain-syntax"> = </span><span class="identifier-syntax">fstat_buff</span><span class="plain-syntax">.</span><span class="identifier-syntax">st_size</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_buff</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_size</span><span class="plain-syntax"> + </span><span class="constant-syntax">1</span><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">file_buff</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"Failed to allocate memory for reading file"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">fclose</span><span class="plain-syntax">(</span><span class="identifier-syntax">file</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">fread</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_buff</span><span class="plain-syntax">, </span><span class="constant-syntax">1</span><span class="plain-syntax">, </span><span class="identifier-syntax">file_size</span><span class="plain-syntax">, </span><span class="identifier-syntax">file</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">file_buff</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_size</span><span class="plain-syntax">] = </span><span class="character-syntax">'\0'</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">fclose</span><span class="plain-syntax">(</span><span class="identifier-syntax">file</span><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_buff</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="identifier-syntax">bool</span><span class="plain-syntax"> </span><span class="function-syntax">is_marked_incompleted</span><span class="plain-syntax">(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">, </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_contents_size</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">char</span><span class="plain-syntax"> </span><span class="identifier-syntax">x1</span><span class="plain-syntax"> = </span><span class="constant-syntax">0xE2</span><span class="plain-syntax">, </span><span class="identifier-syntax">x2</span><span class="plain-syntax"> = </span><span class="constant-syntax">0x9D</span><span class="plain-syntax">, </span><span class="identifier-syntax">x3</span><span class="plain-syntax"> = </span><span class="constant-syntax">0x8C</span><span class="plain-syntax">; </span><span class="comment-syntax"> UTF-8 encoding of 'âŒ'</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">file_contents_size</span><span class="plain-syntax"> - </span><span class="constant-syntax">3</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">char</span><span class="plain-syntax"> </span><span class="identifier-syntax">c1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">];</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">char</span><span class="plain-syntax"> </span><span class="identifier-syntax">c2</span><span class="plain-syntax"> = </span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax"> + </span><span class="constant-syntax">1</span><span class="plain-syntax">];</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">char</span><span class="plain-syntax"> </span><span class="identifier-syntax">c3</span><span class="plain-syntax"> = </span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax"> + </span><span class="constant-syntax">2</span><span class="plain-syntax">];</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">c1</span><span class="plain-syntax"> == </span><span class="identifier-syntax">x1</span><span class="plain-syntax"> &amp;&amp; </span><span class="identifier-syntax">c2</span><span class="plain-syntax"> == </span><span class="identifier-syntax">x2</span><span class="plain-syntax"> &amp;&amp; </span><span class="identifier-syntax">c3</span><span class="plain-syntax"> == </span><span class="identifier-syntax">x3</span><span class="plain-syntax">)</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">true</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">false</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">add_dir</span><button class="popup" onclick="togglePopup('usagePopup13')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup13">Usage of <span class="code-font"><span class="function-syntax">add_dir</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a></span></button><span class="plain-syntax">(</span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax"> **</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">, </span><span class="identifier-syntax">File</span><span class="plain-syntax"> *</span><span class="identifier-syntax">files</span><span class="plain-syntax">, </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">, </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">) {</span>

<span class="plain-syntax">    </span><span class="comment-syntax"> Free dir if not null</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">] != </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax"> != </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="identifier-syntax">size_t</span><span class="plain-syntax"> </span><span class="identifier-syntax">e</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">e</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">; </span><span class="identifier-syntax">e</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">e</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">e</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">e</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">e</span><span class="plain-syntax">].</span><span class="identifier-syntax">parent_dir_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">e</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            }</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">] = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="reserved-syntax">sizeof</span><span class="plain-syntax">(</span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax">));</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">] == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"Failed to allocate memory for dir"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="reserved-syntax">sizeof</span><span class="plain-syntax">(</span><span class="identifier-syntax">File</span><span class="plain-syntax">) * </span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"Failed to allocate memory for files in dir"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_path</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strdup</span><span class="plain-syntax">(</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strdup</span><span class="plain-syntax">(</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax"> =</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">strdup</span><span class="plain-syntax">(</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">parent_dir_path</span><span class="plain-syntax"> =</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">strdup</span><span class="plain-syntax">(</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">parent_dir_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strdup</span><span class="plain-syntax">(</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_type</span><span class="plain-syntax"> = </span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_type</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax"> = </span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_diff</span><span class="plain-syntax"> = </span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_diff</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">file_ct</span><span class="plain-syntax"> = </span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">alphasort</span><button class="popup" onclick="togglePopup('usagePopup14')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup14">Usage of <span class="code-font"><span class="function-syntax">alphasort</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a></span></button><span class="plain-syntax">(</span><span class="reserved-syntax">const</span><span class="plain-syntax"> </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">dirent</span><span class="plain-syntax"> **</span><span class="identifier-syntax">a</span><span class="plain-syntax">, </span><span class="reserved-syntax">const</span><span class="plain-syntax"> </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">dirent</span><span class="plain-syntax"> **</span><span class="identifier-syntax">b</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">strcasecmp</span><span class="plain-syntax">((*</span><span class="identifier-syntax">a</span><span class="plain-syntax">)-&gt;</span><span class="identifier-syntax">d_name</span><span class="plain-syntax">, (*</span><span class="identifier-syntax">b</span><span class="plain-syntax">)-&gt;</span><span class="identifier-syntax">d_name</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="function-syntax">get_filename_no_ext</span><span class="plain-syntax">(</span><span class="reserved-syntax">const</span><span class="plain-syntax"> </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">filename</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">dot</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strrchr</span><span class="plain-syntax">(</span><span class="identifier-syntax">filename</span><span class="plain-syntax">, </span><span class="character-syntax">'.'</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (!</span><span class="identifier-syntax">dot</span><span class="plain-syntax"> || </span><span class="identifier-syntax">dot</span><span class="plain-syntax"> == </span><span class="identifier-syntax">filename</span><span class="plain-syntax">)</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">strdup</span><span class="plain-syntax">(</span><span class="identifier-syntax">filename</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">size_t</span><span class="plain-syntax"> </span><span class="identifier-syntax">len</span><span class="plain-syntax"> = </span><span class="identifier-syntax">dot</span><span class="plain-syntax"> - </span><span class="identifier-syntax">filename</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">no_ext</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="identifier-syntax">len</span><span class="plain-syntax"> + </span><span class="constant-syntax">1</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (!</span><span class="identifier-syntax">no_ext</span><span class="plain-syntax">)</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">strncpy</span><span class="plain-syntax">(</span><span class="identifier-syntax">no_ext</span><span class="plain-syntax">, </span><span class="identifier-syntax">filename</span><span class="plain-syntax">, </span><span class="identifier-syntax">len</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">no_ext</span><span class="plain-syntax">[</span><span class="identifier-syntax">len</span><span class="plain-syntax">] = </span><span class="character-syntax">'\0'</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">no_ext</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="comment-syntax">/ Loops through target directory path and loads files into Directory double</span>
<span class="comment-syntax">/ pointer and returns total exercise files</span>
<span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="function-syntax">load_files</span><button class="popup" onclick="togglePopup('usagePopup15')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup15">Usage of <span class="code-font"><span class="function-syntax">load_files</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a>, <a href="S-all.html#SP2">&#167;2</a></span></button><span class="plain-syntax">(</span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax"> **</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">dirent</span><span class="plain-syntax"> **</span><span class="identifier-syntax">nmlist</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">ex_dirs_ct</span><span class="plain-syntax"> = </span><span class="identifier-syntax">scandir</span><span class="plain-syntax">(</span><span class="identifier-syntax">DIR_PATH</span><span class="plain-syntax">, &amp;</span><span class="identifier-syntax">nmlist</span><span class="plain-syntax">, </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">, </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">alphasort</span></a><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">ex_dirs_ct</span><span class="plain-syntax"> &lt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"could not open directory"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">total_exercise_file_ct</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">di</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">di</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">ex_dirs_ct</span><span class="plain-syntax">; </span><span class="identifier-syntax">di</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">dirent</span><span class="plain-syntax"> *</span><span class="identifier-syntax">de</span><span class="plain-syntax"> = </span><span class="identifier-syntax">nmlist</span><span class="plain-syntax">[</span><span class="identifier-syntax">di</span><span class="plain-syntax">];</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_type</span><span class="plain-syntax"> = </span><span class="identifier-syntax">de</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">d_type</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">file_type</span><span class="plain-syntax"> != </span><span class="identifier-syntax">DIR_TYPE_CODE</span><span class="plain-syntax">)</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">continue</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">strcmp</span><span class="plain-syntax">(</span><span class="identifier-syntax">de</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">d_name</span><span class="plain-syntax">, </span><span class="string-syntax">".."</span><span class="plain-syntax">) == </span><span class="constant-syntax">0</span><span class="plain-syntax"> || </span><span class="identifier-syntax">strcmp</span><span class="plain-syntax">(</span><span class="identifier-syntax">de</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">d_name</span><span class="plain-syntax">, </span><span class="string-syntax">"."</span><span class="plain-syntax">) == </span><span class="constant-syntax">0</span><span class="plain-syntax">)</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">continue</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">paths</span><span class="plain-syntax">[] = {(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *)</span><span class="identifier-syntax">DIR_PATH</span><span class="plain-syntax">, </span><span class="identifier-syntax">de</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">d_name</span><span class="plain-syntax">};</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">nested_path</span><span class="plain-syntax"> = </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">build_file_path</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">paths</span><span class="plain-syntax">, </span><span class="constant-syntax">2</span><span class="plain-syntax">, </span><span class="string-syntax">""</span><span class="plain-syntax">);</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">dirent</span><span class="plain-syntax"> **</span><span class="identifier-syntax">nmlist_nested</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">ex_dirs_nested_ct</span><span class="plain-syntax"> =</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">scandir</span><span class="plain-syntax">(</span><span class="identifier-syntax">nested_path</span><span class="plain-syntax">, &amp;</span><span class="identifier-syntax">nmlist_nested</span><span class="plain-syntax">, </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">, </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">alphasort</span></a><span class="plain-syntax">);</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">ex_dirs_nested_ct</span><span class="plain-syntax"> &lt; </span><span class="constant-syntax">0</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"could not open directory"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">nested_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">        }</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_idx</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">exercise_file_ct</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">File</span><span class="plain-syntax"> *</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">ndi</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">ndi</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">ex_dirs_nested_ct</span><span class="plain-syntax">; </span><span class="identifier-syntax">ndi</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">struct</span><span class="plain-syntax"> </span><span class="identifier-syntax">dirent</span><span class="plain-syntax"> *</span><span class="identifier-syntax">nde</span><span class="plain-syntax"> = </span><span class="identifier-syntax">nmlist_nested</span><span class="plain-syntax">[</span><span class="identifier-syntax">ndi</span><span class="plain-syntax">];</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_type</span><span class="plain-syntax"> = </span><span class="identifier-syntax">nde</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">d_type</span><span class="plain-syntax">;</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_name</span><span class="plain-syntax"> = </span><span class="identifier-syntax">nde</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">d_name</span><span class="plain-syntax">;</span>

<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">file_type</span><span class="plain-syntax"> == </span><span class="identifier-syntax">FILE_TYPE_CODE</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">paths</span><span class="plain-syntax">[] = {(</span><span class="reserved-syntax">char</span><span class="plain-syntax"> *)</span><span class="identifier-syntax">DIR_PATH</span><span class="plain-syntax">, </span><span class="identifier-syntax">de</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">d_name</span><span class="plain-syntax">, </span><span class="identifier-syntax">nde</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">d_name</span><span class="plain-syntax">};</span>

<span class="plain-syntax">                </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">full_path</span><span class="plain-syntax"> = </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">build_file_path</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">paths</span><span class="plain-syntax">, </span><span class="constant-syntax">3</span><span class="plain-syntax">, </span><span class="string-syntax">""</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax"> = </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">read_file_contents</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">full_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">dir_path_size</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strlen</span><span class="plain-syntax">(</span><span class="identifier-syntax">nested_path</span><span class="plain-syntax">) + </span><span class="constant-syntax">1</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_path_size</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strlen</span><span class="plain-syntax">(</span><span class="identifier-syntax">full_path</span><span class="plain-syntax">) + </span><span class="constant-syntax">1</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_name_size</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strlen</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_name</span><span class="plain-syntax">) + </span><span class="constant-syntax">1</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_contents_size</span><span class="plain-syntax"> = </span><span class="identifier-syntax">strlen</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">) + </span><span class="constant-syntax">1</span><span class="plain-syntax">;</span>

<span class="plain-syntax">                </span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_type</span><span class="plain-syntax"> =</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">strcmp</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_name</span><span class="plain-syntax">, </span><span class="identifier-syntax">README_FILE_NM</span><span class="plain-syntax">) == </span><span class="constant-syntax">0</span><span class="plain-syntax"> ? </span><span class="identifier-syntax">README</span><span class="plain-syntax"> : </span><span class="identifier-syntax">EXERCISE</span><span class="plain-syntax">;</span>

<span class="plain-syntax">                </span><span class="identifier-syntax">dir_files</span><span class="plain-syntax"> = </span><span class="identifier-syntax">realloc</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">, (</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax"> + </span><span class="constant-syntax">1</span><span class="plain-syntax">) * </span><span class="reserved-syntax">sizeof</span><span class="plain-syntax">(</span><span class="identifier-syntax">File</span><span class="plain-syntax">));</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"failed to reallocate memory for dir_files"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">                }</span>

<span class="plain-syntax">                </span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_type</span><span class="plain-syntax"> = </span><span class="identifier-syntax">file_type</span><span class="plain-syntax">;</span>

<span class="plain-syntax">                </span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_path</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_path_size</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_path</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"failed to allocate memory for file_path"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">                }</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">strcpy</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">, </span><span class="identifier-syntax">full_path</span><span class="plain-syntax">);</span>

<span class="plain-syntax">                </span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_name_size</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"failed to allocate memory for file_name"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">                }</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">strcpy</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name</span><span class="plain-syntax">, </span><span class="identifier-syntax">file_name</span><span class="plain-syntax">);</span>

<span class="plain-syntax">                </span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax"> =</span>
<span class="plain-syntax">                    </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">get_filename_no_ext</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">file_name</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"failed to allocate memory for file_name_no_ext"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">                }</span>

<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">file_type</span><span class="plain-syntax"> == </span><span class="identifier-syntax">EXERCISE</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">bool</span><span class="plain-syntax"> </span><span class="identifier-syntax">marked_complete</span><span class="plain-syntax"> = </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">is_marked_incompleted</span></a><span class="plain-syntax">(</span>
<span class="plain-syntax">                        </span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">, </span><span class="identifier-syntax">file_contents_size</span><span class="plain-syntax">);</span>

<span class="plain-syntax">                    </span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax"> = </span><span class="identifier-syntax">marked_complete</span><span class="plain-syntax">;</span>

<span class="plain-syntax">                    </span><span class="identifier-syntax">exercise_file_ct</span><span class="plain-syntax">++;</span>
<span class="plain-syntax">                } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">file_type</span><span class="plain-syntax"> == </span><span class="identifier-syntax">README</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax"> = </span><span class="identifier-syntax">false</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax"> = </span><span class="identifier-syntax">false</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                }</span>

<span class="plain-syntax">                </span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">parent_dir_path</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir_path_size</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">parent_dir_path</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"failed to allocate memory for parent_dir_path"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">                }</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">strcpy</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">parent_dir_path</span><span class="plain-syntax">, </span><span class="identifier-syntax">nested_path</span><span class="plain-syntax">);</span>

<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dirs</span><span class="plain-syntax"> != </span><span class="identifier-syntax">NULL</span><span class="plain-syntax"> &amp;&amp; </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">] != </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">old_file_contents</span><span class="plain-syntax"> =</span>
<span class="plain-syntax">                        </span><span class="identifier-syntax">dirs</span><span class="plain-syntax">[</span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">]-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">;</span>

<span class="plain-syntax">                    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">strcmp</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">, </span><span class="identifier-syntax">old_file_contents</span><span class="plain-syntax">) != </span><span class="constant-syntax">0</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                        </span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_diff</span><span class="plain-syntax"> = </span><span class="identifier-syntax">true</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                    } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">                        </span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_diff</span><span class="plain-syntax"> = </span><span class="identifier-syntax">false</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                    }</span>
<span class="plain-syntax">                } </span><span class="reserved-syntax">else</span><span class="plain-syntax"> {</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_diff</span><span class="plain-syntax"> = </span><span class="identifier-syntax">false</span><span class="plain-syntax">;</span>
<span class="plain-syntax">                }</span>

<span class="plain-syntax">                </span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_contents_size</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"failed to allocate memory for file_contents"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                    </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">                }</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">strcpy</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">, </span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">);</span>

<span class="plain-syntax">                </span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">++;</span>

<span class="plain-syntax">                </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">full_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            }</span>
<span class="plain-syntax">        }</span>

<span class="plain-syntax">        </span><a href="S-all.html#SP4" class="function-link"><span class="function-syntax">add_dir</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">, </span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">, </span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">, </span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">total_exercise_file_ct</span><span class="plain-syntax"> += </span><span class="identifier-syntax">exercise_file_ct</span><span class="plain-syntax">;</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">file_idx</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">parent_dir_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name</span><span class="plain-syntax">);</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_name_no_ext</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">dir_files</span><span class="plain-syntax">);</span>

<span class="plain-syntax">        </span><span class="identifier-syntax">dir_idx</span><span class="plain-syntax">++;</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">nested_path</span><span class="plain-syntax">);</span>

<span class="plain-syntax">        </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">ex_dirs_nested_ct</span><span class="plain-syntax">; </span><span class="identifier-syntax">i</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">nmlist_nested</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">]);</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">nmlist_nested</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="reserved-syntax">int</span><span class="plain-syntax"> </span><span class="identifier-syntax">di</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">di</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">ex_dirs_ct</span><span class="plain-syntax">; </span><span class="identifier-syntax">di</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">nmlist</span><span class="plain-syntax">[</span><span class="identifier-syntax">di</span><span class="plain-syntax">]);</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">free</span><span class="plain-syntax">(</span><span class="identifier-syntax">nmlist</span><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">total_exercise_file_ct</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>
</pre>
<ul class="endnotetexts"><li>This code is never used.</li></ul>
<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5.  </b><span class="named-paragraph-container code-font"><span class="named-paragraph-defn">exercise</span><span class="named-paragraph-number">5</span></span><span class="comment-syntax"> =</span>
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><span class="function-syntax">create_exercise</span><button class="popup" onclick="togglePopup('usagePopup16')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup16">Usage of <span class="code-font"><span class="function-syntax">create_exercise</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a>, <a href="S-all.html#SP2">&#167;2</a></span></button><span class="plain-syntax">(</span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax"> *</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="reserved-syntax">sizeof</span><span class="plain-syntax">(</span><span class="identifier-syntax">Exercise</span><span class="plain-syntax">));</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">exercise</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">readme</span><span class="plain-syntax"> = </span><span class="identifier-syntax">get_readme</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">exercise</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">exercise_files</span><span class="plain-syntax"> = </span><span class="identifier-syntax">get_exercises</span><span class="plain-syntax">(</span><span class="identifier-syntax">dirs</span><span class="plain-syntax">);</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">exercise</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>

<span class="reserved-syntax">char</span><span class="plain-syntax">* </span><span class="identifier-syntax">get_readme</span><span class="plain-syntax">(</span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax"> *</span><span class="identifier-syntax">dir</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="identifier-syntax">size_t</span><span class="plain-syntax"> </span><span class="identifier-syntax">f</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">f</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">dir</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">; </span><span class="identifier-syntax">f</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">FileType</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_type</span><span class="plain-syntax"> = </span><span class="identifier-syntax">dir</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">f</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_type</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">file_type</span><span class="plain-syntax"> == </span><span class="identifier-syntax">README</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">dir</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">f</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_contents</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">puts</span><span class="plain-syntax">(</span><span class="string-syntax">"error: no readme found in directory"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">}</span>

<span class="identifier-syntax">FileCollection</span><span class="plain-syntax">* </span><span class="identifier-syntax">get_exercises</span><span class="plain-syntax">(</span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax"> *</span><span class="identifier-syntax">dir</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax">* </span><span class="identifier-syntax">result</span><span class="plain-syntax"> = </span><span class="identifier-syntax">malloc</span><span class="plain-syntax">(</span><span class="reserved-syntax">sizeof</span><span class="plain-syntax">(</span><span class="identifier-syntax">FileCollection</span><span class="plain-syntax">));</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">result</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"Failed to allocate memory for result"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">result</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax"> = </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">result</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">file_ct</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="identifier-syntax">size_t</span><span class="plain-syntax"> </span><span class="identifier-syntax">f</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">f</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">dir</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">; </span><span class="identifier-syntax">f</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">FileType</span><span class="plain-syntax"> </span><span class="identifier-syntax">file_type</span><span class="plain-syntax"> = </span><span class="identifier-syntax">dir</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">f</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_type</span><span class="plain-syntax">;</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">file_type</span><span class="plain-syntax"> == </span><span class="identifier-syntax">EXERCISE</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">result</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax"> = </span><span class="identifier-syntax">realloc</span><span class="plain-syntax">(</span><span class="identifier-syntax">result</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">, (</span><span class="identifier-syntax">result</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">file_ct</span><span class="plain-syntax"> + </span><span class="constant-syntax">1</span><span class="plain-syntax">) * </span><span class="reserved-syntax">sizeof</span><span class="plain-syntax">(</span><span class="identifier-syntax">File</span><span class="plain-syntax">));</span>
<span class="plain-syntax">            </span><span class="reserved-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">result</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax"> == </span><span class="identifier-syntax">NULL</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">perror</span><span class="plain-syntax">(</span><span class="string-syntax">"Failed to realloc memory for get_exercises"</span><span class="plain-syntax">);</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">exit</span><span class="plain-syntax">(1);</span>
<span class="plain-syntax">            }</span>

<span class="plain-syntax">            </span><span class="identifier-syntax">result</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">result</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">] = </span><span class="identifier-syntax">dir</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">f</span><span class="plain-syntax">];</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">result</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">++;</span>
<span class="plain-syntax">        }</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">result</span><span class="plain-syntax">;</span>
<span class="plain-syntax">}</span>
</pre>
<ul class="endnotetexts"><li>This code is never used.</li></ul>
<p class="commentary firstcommentary"><a id="SP6" class="paragraph-anchor"></a><b>&#167;6.  </b><span class="named-paragraph-container code-font"><span class="named-paragraph-defn">display</span><span class="named-paragraph-number">6</span></span><span class="comment-syntax"> =</span>
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">display</span><button class="popup" onclick="togglePopup('usagePopup17')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup17">Usage of <span class="code-font"><span class="function-syntax">display</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a>, <a href="S-all.html#SP2">&#167;2</a></span></button><span class="plain-syntax">(</span><span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, </span><span class="identifier-syntax">ExecutionState</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">, </span><span class="identifier-syntax">DisplayMode</span><span class="plain-syntax"> </span><span class="identifier-syntax">display_mode</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">switch</span><span class="plain-syntax"> (</span><span class="identifier-syntax">display_mode</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">FAILURE</span><span class="plain-syntax">:</span>
<span class="plain-syntax">        </span><a href="S-all.html#SP1" class="function-link"><span class="function-syntax">display_progress</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">failing_file</span><span class="plain-syntax">, </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">total_files</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><a href="S-all.html#SP7" class="function-link"><span class="function-syntax">display_failure</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">MARKED_INCOMPLETE</span><span class="plain-syntax">:</span>
<span class="plain-syntax">        </span><a href="S-all.html#SP1" class="function-link"><span class="function-syntax">display_progress</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">failing_file</span><span class="plain-syntax">, </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">total_files</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><a href="S-all.html#SP1" class="function-link"><span class="function-syntax">display_marked_incomplete</span></a><span class="plain-syntax">(</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, </span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">);</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>

<span class="plain-syntax">    </span><span class="reserved-syntax">case</span><span class="plain-syntax"> </span><span class="identifier-syntax">COMPLETE</span><span class="plain-syntax">:</span>
<span class="plain-syntax">        </span><a href="S-all.html#SP9" class="function-link"><span class="function-syntax">display_success</span></a><span class="plain-syntax">();</span>
<span class="plain-syntax">        </span><span class="reserved-syntax">break</span><span class="plain-syntax">;</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">}</span>
</pre>
<ul class="endnotetexts"><li>This code is never used.</li></ul>
<p class="commentary firstcommentary"><a id="SP7" class="paragraph-anchor"></a><b>&#167;7. Failure display, using indirection to select a function for communicating with the user. </b></p>

<p class="commentary">This function was the first "big one" I refactored after forking clings. I used what I knew, and jumbled together a refactor which only has a single branch of execution and determines the next step of computation to perform, and what verb to print, using indirection rather than duplicating code and using a simple if statement. This isn't a good example of good programming, it's a good example of over-complication, actually. There's absolutely no reason to abstract this area of the code. It was written as an exercise.
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">display_failure</span><button class="popup" onclick="togglePopup('usagePopup18')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup18">Usage of <span class="code-font"><span class="function-syntax">display_failure</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a>, <a href="S-all.html#SP6">&#167;6</a></span></button><span class="plain-syntax">(</span><span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">, </span><span class="identifier-syntax">ExecutionState</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">char</span><span class="plain-syntax"> *</span><span class="identifier-syntax">failure_type_verb</span><span class="plain-syntax">[] = { </span><span class="string-syntax">"Execution"</span><span class="plain-syntax">, </span><span class="string-syntax">"Compilation"</span><span class="plain-syntax"> };</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">int</span><span class="plain-syntax"> (*</span><span class="identifier-syntax">failure_function</span><span class="plain-syntax">[])(</span><span class="identifier-syntax">File</span><span class="plain-syntax">) = { </span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_run_output</span></a><span class="plain-syntax">, </span><a href="S-all.html#SP3" class="function-link"><span class="function-syntax">exec_compile_output</span></a><span class="plain-syntax"> };</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">fprintf</span><span class="plain-syntax">(</span><span class="identifier-syntax">text_bold</span><span class="plain-syntax">(</span><span class="identifier-syntax">text_red</span><span class="plain-syntax">(</span><span class="identifier-syntax">stdout</span><span class="plain-syntax">)),</span>
<span class="plain-syntax">            </span><span class="string-syntax">"Â  %s of %s failed! Please try again. Here's the output: \n\n"</span><span class="plain-syntax">,</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">failure_type_verb</span><span class="plain-syntax">[</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">failure_mode</span><span class="plain-syntax">],</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">exercise</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">exercise_files</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">failing_file</span><span class="plain-syntax">].</span><span class="identifier-syntax">file_path</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">reset_colors</span><span class="plain-syntax">(</span><span class="identifier-syntax">stdout</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    (*</span><span class="identifier-syntax">failure_function</span><span class="plain-syntax">[</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">failure_mode</span><span class="plain-syntax">])(</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">exercise_files</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">exercise_state</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">failing_file</span><span class="plain-syntax">]);</span>
<span class="plain-syntax">}</span>
</pre>
<p class="commentary firstcommentary"><a id="SP8" class="paragraph-anchor"></a><b>&#167;8.  </b>void display_marked_incomplete(Exercise *exercise, ExecutionState *exercise_state) {
    File failed_file = exercise-&gt;exercise_files-&gt;files[exercise_state-&gt;failing_file];
</p>

<p class="commentary">    char msg[] = ("Â›1;34m1 <span class="extract"><span class="extract-syntax"> Â›0m// L I AM NOT DONE\n"
</span></span>                  "Â›1;34m2 <span class="extract"><span class="extract-syntax"> Â›0m\n"
</span></span>                  "Â›1;34m3 <span class="extract"><span class="extract-syntax"> Â›0m\n");
</span></span></p>

<p class="commentary">    printf("âœ… \033[1;32mYou've completed exercise: %s \033[0m\n\n",
           exercise-&gt;exercise_files-&gt;files[exercise_state-&gt;failing_file].file_path);
    printf("ÿ˜Ž The code is compiling! ÿ˜Ž\n\n"
</p>

<p class="commentary">           "Output: \n%s\n",
           "==========================================");
    exec_run_output(failed_file);
    printf("==========================================\n"
           "You can keep working on it for fun, or delete the commented line below in the\n"
           "exercise file to proceed to the next exercise.\n"
           "%s\n", msg);
}
</p>

<p class="commentary">void display_progress(int current_exercise, int total_exercises) {
    int current_exercise_non_zero = current_exercise == 0 ? 1:current_exercise;
    float progress = (float)current_exercise_non_zero / total_exercises;
    char msg[300]; /* Previously, this was initialized as the null string for some odd reason. */
</p>

<p class="commentary">    for (int ci = 0; ci &lt; 50; ci++) {
        float cip = (float)ci / 50;
        if (cip * 100 &lt;= progress * 100) {
            strcat(msg, "â–ˆ");
        } else {
            strcat(msg, "-");
        }
    }
</p>

<p class="commentary">    fprintf(text_bold(stdout), "Â›2J\rProgress: %s\n", msg);
    reset_colors(stdout);
}
</p>

<p class="commentary firstcommentary"><a id="SP9" class="paragraph-anchor"></a><b>&#167;9.  </b>Congratulating the user on completing klingons
</p>

<p class="commentary">The following small function, which is only so small thanks to some refactoring
that I performed when I first looked into contributing to clings, simply
congratulates the user for finishing all the exercises.
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">display_success</span><button class="popup" onclick="togglePopup('usagePopup19')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup19">Usage of <span class="code-font"><span class="function-syntax">display_success</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a>, <a href="S-all.html#SP6">&#167;6</a></span></button><span class="plain-syntax">() {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">fputs</span><span class="plain-syntax">(</span><span class="named-paragraph-container code-font"><a href="S-all.html#SP9_1" class="named-paragraph-link"><span class="named-paragraph">klingons logogram</span><span class="named-paragraph-number">9.1</span></a></span><span class="plain-syntax">, </span><span class="identifier-syntax">text_bold</span><span class="plain-syntax">(</span><span class="identifier-syntax">stdout</span><span class="plain-syntax">));</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">fputs</span><span class="plain-syntax">(</span><span class="string-syntax">"Congratulations on completing klingons!"</span><span class="plain-syntax">, </span><span class="identifier-syntax">text_green</span><span class="plain-syntax">(</span><span class="identifier-syntax">stdout</span><span class="plain-syntax">));</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">reset_colors</span><span class="plain-syntax">(</span><span class="identifier-syntax">stdout</span><span class="plain-syntax">);</span>
<span class="plain-syntax">}</span>
</pre>
<p class="commentary firstcommentary"><a id="SP10" class="paragraph-anchor"></a><b>&#167;10.  </b>Debugging display
</p>

<p class="commentary">The following display pattern is for when the klingons program is being debugged.
</p>

<pre class="displayed-code all-displayed-code code-font">

<span class="reserved-syntax">void</span><span class="plain-syntax"> </span><span class="function-syntax">display_debug</span><button class="popup" onclick="togglePopup('usagePopup20')"><span class="comment-syntax">?</span><span class="popuptext" id="usagePopup20">Usage of <span class="code-font"><span class="function-syntax">display_debug</span></span>:<br/><a href="S-all.html#SP1">&#167;1</a>, <a href="S-all.html#SP2">&#167;2</a></span></button><span class="plain-syntax">(</span><span class="identifier-syntax">Exercise</span><span class="plain-syntax"> *</span><span class="identifier-syntax">exercise</span><span class="plain-syntax">) {</span>
<span class="plain-syntax">    </span><span class="reserved-syntax">for</span><span class="plain-syntax"> (</span><span class="identifier-syntax">size_t</span><span class="plain-syntax"> </span><span class="identifier-syntax">fi</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span><span class="plain-syntax">; </span><span class="identifier-syntax">fi</span><span class="plain-syntax"> &lt; </span><span class="identifier-syntax">exercise</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">exercise_files</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">file_ct</span><span class="plain-syntax">; </span><span class="identifier-syntax">fi</span><span class="plain-syntax">++) {</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">File</span><span class="plain-syntax"> </span><span class="identifier-syntax">exercise_file</span><span class="plain-syntax"> = </span><span class="identifier-syntax">exercise</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">exercise_files</span><span class="plain-syntax">-&gt;</span><span class="identifier-syntax">files</span><span class="plain-syntax">[</span><span class="identifier-syntax">fi</span><span class="plain-syntax">];</span>

<span class="plain-syntax">        </span><span class="identifier-syntax">printf</span><span class="plain-syntax">(</span><span class="string-syntax">"Exercise: %s | File type: %i | marked incomplete: %i | file diff "</span>
<span class="plain-syntax">               </span><span class="string-syntax">"found: %i \n"</span><span class="plain-syntax">,</span>
<span class="plain-syntax">               </span><span class="identifier-syntax">exercise_file</span><span class="plain-syntax">.</span><span class="identifier-syntax">file_name</span><span class="plain-syntax">, </span><span class="identifier-syntax">exercise_file</span><span class="plain-syntax">.</span><span class="identifier-syntax">file_type</span><span class="plain-syntax">,</span>
<span class="plain-syntax">               </span><span class="identifier-syntax">exercise_file</span><span class="plain-syntax">.</span><span class="identifier-syntax">marked_incomplete</span><span class="plain-syntax">, </span><span class="identifier-syntax">exercise_file</span><span class="plain-syntax">.</span><span class="identifier-syntax">file_diff</span><span class="plain-syntax">);</span>
<span class="plain-syntax">    }</span>
<span class="plain-syntax">}</span>
</pre>
<!--End of weave-->

	</body>
</html>

